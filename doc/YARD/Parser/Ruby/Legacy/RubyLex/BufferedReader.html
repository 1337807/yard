<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta name="Content-Type" content="text/html; charset=UTF-8" />
    <title>Class: YARD::Parser::Ruby::Legacy::RubyLex::BufferedReader</title>
    <link rel="stylesheet" href="../../../../../css/style.css" type="text/css" media="screen" charset="utf-8" />
    <link rel="stylesheet" href="../../../../../css/common.css" type="text/css" media="screen" charset="utf-8" />
    
    <script type="text/javascript" charset="utf-8">
      relpath = '../../../../..';
      if (relpath != '') relpath += '/';
    </script>
    <script type="text/javascript" charset="utf-8" src="../../../../../js/jquery.js"></script>
    <script type="text/javascript" charset="utf-8" src="../../../../../js/autocomplete.js"></script>
    <script type="text/javascript" charset="utf-8" src="../../../../../js/app.js"></script>
  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../../../../../glossary.html">Glossary (B)</a> :: 
    <a href="../../../../../YARD.html" title="YARD">YARD</a> :: <a href="../../../../Parser.html" title="Parser">Parser</a> :: <a href="../../../Ruby.html" title="Ruby">Ruby</a> :: <a href="../../Legacy.html" title="Legacy">Legacy</a> :: <a href="../RubyLex.html" title="RubyLex">RubyLex</a>
     :: 
    BufferedReader
  
</div>

      <div id="search">
        <a id="class_list_link" href="#">Namespace List</a> |
        <a id="method_list_link" href="#">Method List</a> |
        <a id ="file_list_link" href="#">File List</a>
      </div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: YARD::Parser::Ruby::Legacy::RubyLex::BufferedReader</h1>
<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
      </dd>
    
  
  
    
  
    
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/yard/parser/ruby/legacy/ruby_lex.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
      <p>
####################################################################
</p>
<p>
Read an input stream character by character. We allow for unlimited
ungetting of characters just read.
</p>
<p>
We simplify the implementation greatly by reading the entire input into a
buffer initially, and then simply traversing it using pointers.
</p>
<p>
We also have to allow for the <em>here document diversion</em>. This little
gem comes about when the lexer encounters a here document. At this point we
effectively need to split the input stream into two parts: one to read the
body of the here document, the other to read the rest of the input line
where the here document was initially encountered. For example, we might
have
</p>
<pre class="code">
  <span class='id do_something'>do_something</span><span class='lparen'>(</span><span class='heredoc_beg'>&lt;&lt;-A</span><span class='tstring_content'>    stuff
    for
</span><span class='heredoc_end'>  A
</span><span class='comma'>,</span> <span class='heredoc_beg'>&lt;&lt;-B</span><span class='tstring_content'>    stuff
    for
</span><span class='heredoc_end'>  B
</span><span class='rparen'>)</span>
</pre>
<p>
When the lexer encounters the <<A, it reads until the end of the line, and
keeps it around for later. It then reads the body of the here document.
Once complete, it needs to read the rest of the original line, but then
skip the here document body.
</p>


  </div>
</div>
<div class="tags">
  
</div>  <h2>Attribute Summary</h2>
  <ul class="summary">
    
      <li class="public "><a href="#line_num-instance_method" title="- (Object) line_num ">- (Object) line_num </a> <span class="extras">(readonly)</span>
        
          <span class="summary_desc">
Returns the value of attribute <tt>line_num</tt>.

</span>
        
      </li>
    
  </ul>
  <h2>Method Summary</h2>
  <ul class="summary">
    
      <li class="public ">
        <a href="#column-instance_method" title="- (Object) column ">- (Object) column </a>
        
        
        
      </li>
    
      <li class="public ">
        <a href="#divert_read_from-instance_method" title="- (Object) divert_read_from(reserve) ">- (Object) divert_read_from(reserve) </a>
        
        
        
      </li>
    
      <li class="public ">
        <a href="#get_read-instance_method" title="- (Object) get_read ">- (Object) get_read </a>
        
        
        
      </li>
    
      <li class="public ">
        <a href="#getc-instance_method" title="- (Object) getc ">- (Object) getc </a>
        
        
        
      </li>
    
      <li class="public ">
        <a href="#getc_already_read-instance_method" title="- (Object) getc_already_read ">- (Object) getc_already_read </a>
        
        
        
      </li>
    
      <li class="public ">
        <a href="#initialize-instance_method" title="- (Object) initialize(content) ">- (Object) initialize(content) </a>
        
        
        
      </li>
    
      <li class="public ">
        <a href="#peek-instance_method" title="- (Object) peek(at) ">- (Object) peek(at) </a>
        
        
        
      </li>
    
      <li class="public ">
        <a href="#peek_equal-instance_method" title="- (Object) peek_equal(str) ">- (Object) peek_equal(str) </a>
        
        
        
      </li>
    
      <li class="public ">
        <a href="#ungetc-instance_method" title="- (Object) ungetc(ch) ">- (Object) ungetc(ch) </a>
        
        
        
      </li>
    
  </ul>
  <div id="attr_details">
    <h2>Attribute Details</h2>
    
      
      <span id=""></span>
      <span id="line_num-instance_method"></span>
      <div class="method_details">
  <p class="signature first" id="line_num-instance_method">
  
    - (Object) line_num  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
      <p>
Returns the value of attribute <tt>line_num</tt>
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


337
338
339</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/yard/parser/ruby/legacy/ruby_lex.rb', line 337</span>

<span class='kw'>def</span> <span class='id line_num'>line_num</span>
  <span class='ivar'>@line_num</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>
<div id="constructor_details">
  <h2>Constructor Details</h2>
  
    <div class="method_details">
  <p class="signature first" id="initialize-instance_method">
  
    - (Object) initialize(content) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/yard/parser/ruby/legacy/ruby_lex.rb', line 339</span>

<span class='kw'>def</span> <span class='id initialize'>initialize</span><span class='lparen'>(</span><span class='id content'>content</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\t</span><span class='regexp_end'>/</span></span> <span class='op'>=~</span> <span class='id content'>content</span>
    <span class='id tab_width'>tab_width</span> <span class='op'>=</span> <span class='int'>2</span>
    <span class='id content'>content</span> <span class='op'>=</span> <span class='id content'>content</span><span class='period'>.</span><span class='id split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\n</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id line'>line</span><span class='op'>|</span>
      <span class='int'>1</span> <span class='kw'>while</span> <span class='id line'>line</span><span class='period'>.</span><span class='id gsub!'>gsub!</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\t+</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'> </span><span class='tstring_end'>'</span></span> <span class='op'>*</span> <span class='lparen'>(</span><span class='id tab_width'>tab_width</span><span class='op'>*</span><span class='backref'>$&amp;</span><span class='period'>.</span><span class='id length'>length</span> <span class='op'>-</span> <span class='backref'>$`</span><span class='period'>.</span><span class='id length'>length</span> <span class='op'>%</span> <span class='id tab_width'>tab_width</span><span class='rparen'>)</span><span class='rbrace'>}</span>  <span class='op'>&amp;&amp;</span> <span class='gvar'>$~</span> <span class='comment'>#`
</span>      <span class='id line'>line</span>
    <span class='kw'>end</span> <span class='period'>.</span><span class='id join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='ivar'>@content</span>   <span class='op'>=</span> <span class='id content'>content</span>
  <span class='ivar'>@content</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='ivar'>@content</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span>
  <span class='ivar'>@size</span>      <span class='op'>=</span> <span class='ivar'>@content</span><span class='period'>.</span><span class='id size'>size</span>
  <span class='ivar'>@offset</span>    <span class='op'>=</span> <span class='int'>0</span>
  <span class='ivar'>@hwm</span>       <span class='op'>=</span> <span class='int'>0</span>
  <span class='ivar'>@line_num</span>  <span class='op'>=</span> <span class='int'>1</span>
  <span class='ivar'>@read_back_offset</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='ivar'>@last_newline</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='ivar'>@newline_pending</span> <span class='op'>=</span> <span class='kw'>false</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>
  <div id="method_details">
    <h2>Method Details</h2>
    
      <div class="method_details">
  <p class="signature first" id="column-instance_method">
  
    - (Object) column 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


358
359
360</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/yard/parser/ruby/legacy/ruby_lex.rb', line 358</span>

<span class='kw'>def</span> <span class='id column'>column</span>
  <span class='ivar'>@offset</span> <span class='op'>-</span> <span class='ivar'>@last_newline</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details">
  <p class="signature " id="divert_read_from-instance_method">
  
    - (Object) divert_read_from(reserve) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


412
413
414
415</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/yard/parser/ruby/legacy/ruby_lex.rb', line 412</span>

<span class='kw'>def</span> <span class='id divert_read_from'>divert_read_from</span><span class='lparen'>(</span><span class='id reserve'>reserve</span><span class='rparen'>)</span>
  <span class='ivar'>@content</span><span class='lbracket'>[</span><span class='ivar'>@offset</span><span class='comma'>,</span> <span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id reserve'>reserve</span>
  <span class='ivar'>@size</span>      <span class='op'>=</span> <span class='ivar'>@content</span><span class='period'>.</span><span class='id size'>size</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details">
  <p class="signature " id="get_read-instance_method">
  
    - (Object) get_read 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


393
394
395
396
397</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/yard/parser/ruby/legacy/ruby_lex.rb', line 393</span>

<span class='kw'>def</span> <span class='id get_read'>get_read</span>
  <span class='id res'>res</span> <span class='op'>=</span> <span class='ivar'>@content</span><span class='lbracket'>[</span><span class='ivar'>@read_back_offset</span><span class='op'>...</span><span class='ivar'>@offset</span><span class='rbracket'>]</span>
  <span class='ivar'>@read_back_offset</span> <span class='op'>=</span> <span class='ivar'>@offset</span>
  <span class='id res'>res</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details">
  <p class="signature " id="getc-instance_method">
  
    - (Object) getc 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/yard/parser/ruby/legacy/ruby_lex.rb', line 362</span>

<span class='kw'>def</span> <span class='id getc'>getc</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='ivar'>@offset</span> <span class='op'>&gt;=</span> <span class='ivar'>@size</span>
  <span class='id ch'>ch</span> <span class='op'>=</span> <span class='ivar'>@content</span><span class='lbracket'>[</span><span class='ivar'>@offset</span><span class='comma'>,</span> <span class='int'>1</span><span class='rbracket'>]</span>
      
  <span class='ivar'>@offset</span> <span class='op'>+=</span> <span class='int'>1</span>
  <span class='ivar'>@hwm</span> <span class='op'>=</span> <span class='ivar'>@offset</span> <span class='kw'>if</span> <span class='ivar'>@hwm</span> <span class='op'>&lt;</span> <span class='ivar'>@offset</span>
      
  <span class='kw'>if</span> <span class='ivar'>@newline_pending</span>
    <span class='ivar'>@line_num</span> <span class='op'>+=</span> <span class='int'>1</span>
    <span class='ivar'>@last_newline</span> <span class='op'>=</span> <span class='ivar'>@offset</span> <span class='op'>-</span> <span class='int'>1</span>
    <span class='ivar'>@newline_pending</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='kw'>end</span>
      
  <span class='kw'>if</span> <span class='id ch'>ch</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span>
    <span class='ivar'>@newline_pending</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>end</span>
  <span class='id ch'>ch</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details">
  <p class="signature " id="getc_already_read-instance_method">
  
    - (Object) getc_already_read 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


381
382
383</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/yard/parser/ruby/legacy/ruby_lex.rb', line 381</span>

<span class='kw'>def</span> <span class='id getc_already_read'>getc_already_read</span>
  <span class='id getc'>getc</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details">
  <p class="signature " id="peek-instance_method">
  
    - (Object) peek(at) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


399
400
401
402
403
404
405
406</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/yard/parser/ruby/legacy/ruby_lex.rb', line 399</span>

<span class='kw'>def</span> <span class='id peek'>peek</span><span class='lparen'>(</span><span class='id at'>at</span><span class='rparen'>)</span>
  <span class='id pos'>pos</span> <span class='op'>=</span> <span class='ivar'>@offset</span> <span class='op'>+</span> <span class='id at'>at</span>
  <span class='kw'>if</span> <span class='id pos'>pos</span> <span class='op'>&gt;=</span> <span class='ivar'>@size</span>
    <span class='kw'>nil</span>
  <span class='kw'>else</span>
    <span class='ivar'>@content</span><span class='lbracket'>[</span><span class='id pos'>pos</span><span class='comma'>,</span> <span class='int'>1</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details">
  <p class="signature " id="peek_equal-instance_method">
  
    - (Object) peek_equal(str) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


408
409
410</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/yard/parser/ruby/legacy/ruby_lex.rb', line 408</span>

<span class='kw'>def</span> <span class='id peek_equal'>peek_equal</span><span class='lparen'>(</span><span class='id str'>str</span><span class='rparen'>)</span>
  <span class='ivar'>@content</span><span class='lbracket'>[</span><span class='ivar'>@offset</span><span class='comma'>,</span> <span class='id str'>str</span><span class='period'>.</span><span class='id length'>length</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='id str'>str</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details">
  <p class="signature " id="ungetc-instance_method">
  
    - (Object) ungetc(ch) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


385
386
387
388
389
390
391</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/yard/parser/ruby/legacy/ruby_lex.rb', line 385</span>

<span class='kw'>def</span> <span class='id ungetc'>ungetc</span><span class='lparen'>(</span><span class='id ch'>ch</span><span class='rparen'>)</span>
  <span class='id raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>unget past beginning of file</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='ivar'>@offset</span> <span class='op'>&lt;=</span> <span class='int'>0</span>
  <span class='ivar'>@offset</span> <span class='op'>-=</span> <span class='int'>1</span>
  <span class='kw'>if</span> <span class='ivar'>@content</span><span class='lbracket'>[</span><span class='ivar'>@offset</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='CHAR'>?\n</span>
    <span class='ivar'>@newline_pending</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>
</div>
    
    <div id="footer">Powered by yard 0.2.3.5 (ruby-1.9.1)</div>
  </body>
</html>